- step:
    name: data_preparation
    image: pytorch/pytorch:1.9.0-cuda10.2-cudnn7-runtime
    command:
      - pip install pandas
      - tar -zxvf /valohai/inputs/data/food-101.tar.gz -C /valohai/inputs/data
      - python -m prepare_data {parameters}
    inputs:
      - name: data
        default:
          - s3://jsk-valohai/dino-image-retrieval/data/food-101.tar.gz
    parameters:
      - name: imsize
        description: Input image size
        type: integer
        default: 512
      - name: multiscale
        description: Whether to enable multiscale image feature extraction or not
        type: flag
        pass-true-as: --multiscale=1
        pass-false-as: --multiscale=0
        default: true
      - name: data_path
        description: /path/to/dataset/
        type: string
        default: /valohai/inputs/data/food-101
      - name: output_path
        description: /path/to/where/computed/features/will/be/saved
        type: string
        default: /valohai/outputs/
      - name: output_prefix
        description: Prefix prepended to output features and labels filenames
        type: string
        default: dino
      - name: distributed
        description: Whether to enable distributed computing or not
        type: flag
        pass-true-as: --distributed=1
        pass-false-as: --distributed=0
        default: true